<!DOCTYPE html><html lang="en-lang"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>cookie与session · dxer</title><meta name="description" content="cookie与session - dxer"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.ico"><link rel="stylesheet" href="/css/style.css"><!-- fonts--><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" href="http://fonts.lug.ustc.edu.cn/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><input type="checkbox" id="sidebar-toggle"><aside><div class="author"><a href="/."><img src="/img/author.png" class="author-img"></a><h2 class="author-name">dxer</h2></div><div class="post-toc"><span class="toc-title">Directory</span><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#cookie"><span class="toc-text">cookie</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#cookie的不可跨域性"><span class="toc-text">cookie的不可跨域性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#session"><span class="toc-text">session</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#session的生命周期"><span class="toc-text">session的生命周期</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#session的有效期"><span class="toc-text">session的有效期</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#URL重写"><span class="toc-text">URL重写</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cookie与session的区别"><span class="toc-text">cookie与session的区别</span></a></li></ol></div></aside><div class="main"><header><div id="top"><a href="/." class="logo-link">dxer</a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">Archive</a></li><li class="nav-list-item"><a href="/tags/" target="_self" class="nav-list-link">Tags</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">About</a></li></ul></div></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">cookie与session</h1><div class="post-time">Apr 17, 2015</div><div class="post-content"><p>会话（session）跟踪式web程序中常用的技术，用来跟踪用户的整个会话。常用的会话跟踪技术是cookie与session。coolie是通过在客户端记录信息确定用户身份，session是通过在服务端记录信息确定用户身份。<br><a id="more"></a></p>
<h2 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h2><p>cookie技术是客户端解决方案。cookie是由服务器发给客户端的特殊信息，这些信息以文本的方式存放在客户端，客户端每次向服务器发送请求的时候都会带上这些特殊的信息。</p>
<p>例如：在用户访问一个网站的时候，先登录，用户将用户名和密码发送给服务器；服务器对用户名和密码进行验证，验证成功后，会向客户端回传相应的超文本信息的同时也是返回这些个人信息，这些个人信息存放在HTTP的头部；当客户端接收到服务端的响应之后，浏览器会将这些个人信息存放在一个统一的位置；后面如果客户端再向服务端请求的时候，都会把cookie信息发回到服务器。服务器在接收到来自客户端的请求之后，分析存放于请求头的cookie信息，得到用户相关信息，从而生成与该客户端请求的内容。</p>
<p>cookie是弥补HTTP协议的无状态的不足。</p>
<p>cookies是HTTP的一个扩展，有两个专门负责设置以及发送cookie的http头部，Set-Cookie和Cookie。当服务器返回给客户端一个http响应时，如果包含Set-Cookie这个头部时，指示客户端建立一个新的cookie，并且在后续的http请求中自动发送这个cookie到服务端，直到这个cookie过期。如果cookie的生存时间是整个会话期间，浏览器会将cookie保存在内存中个，在浏览器关闭的时候会自动清除这个cookie。cookie也可以保存在客户端的磁盘上，这种情况，在浏览器关闭之后，该cookie也不会清除，下次打开浏览器访问对应网站的时候，这个cookie就会自动再次发送到服务器端。</p>
<p>客户端发送一个http请求到服务器端，服务器端发送一个http响应到客户端，其中包含Set-Cookie头部</p>
<p>客户端发送一个http请求到服务器端，其中包含Cookie头部</p>
<h3 id="cookie的不可跨域性"><a href="#cookie的不可跨域性" class="headerlink" title="cookie的不可跨域性"></a>cookie的不可跨域性</h3><p>很多网站都会使用cookie，但是不同网站的只能使用本网站生成的cookie，不能进行跨域访问。</p>
<p>cookie中使用Unicode字符时，需要对Unicode字符进行编码，否则会乱码</p>
<p>cookie不仅可以使用ASCII字符与Unicode字符，还可以使用二进制数据，</p>
<hr>
<h2 id="session"><a href="#session" class="headerlink" title="session"></a>session</h2><p>web应用中还经常使用session来记录客户端的状态，session是服务器端使用的一种记录客户端状态的机制，比cookie简单，但是会增加服务器的存储压力</p>
<p>session技术是服务器端的解决方案，它是通过服务器来保持状态的，客户端浏览器访问服务器的时候，服务器把客户端信息以某种形式记录在服务器上，这个就是session。客户端浏览器再次访问时只需要从该session中查找客户的章台就可以了。</p>
<p>session类似在服务器上建立了一个客户档案，客户来访的时候只需要查询客户档案就可以了。</p>
<h3 id="session的生命周期"><a href="#session的生命周期" class="headerlink" title="session的生命周期"></a>session的生命周期</h3><p>session是保存在服务端的，为了获得更高的存取速度，服务器一般把session放在内存中，每个用户都会拥有一个独立的session。如果session的内容太复杂，当亮亮客户访问的时候，会导致服务器内存溢出。所以session里的信息应当尽量精简。</p>
<p>session在用户第一次访问服务器的时候自动创建，访问服务器端的静态资源是不会产生session的</p>
<p>session生成后，用户只要继续访问，服务器就会更新session的最后访问时间，并维护该sessin，用户没访问服务器一次，无论是否读写session，服务器都认为该用户的session“活跃”了一次</p>
<h3 id="session的有效期"><a href="#session的有效期" class="headerlink" title="session的有效期"></a>session的有效期</h3><p>由于访问服务端的用户会越来越多，因此session也会越来越多，为了防止内存溢出，如果超过了超时时间也没有访问服务器端，该session就会自动失效了。</p>
<p>session对浏览器的要求</p>
<p>虽然session保存在服务器端，对客户端是透明的，它的正常运行任然需要客户端浏览器的支持，因为session需要使用cookie作为识别标志。HTTP协议是无状态的，session不能通过HTTP链接来判断是否是同一个用户，因此服务器向客户端浏览器发送一个名为JSESSIONID的cookie，它的值为该Session的id。</p>
<p>该cookie是服务器端自动生成的，它的maxAge属性为-1，表示仅当前浏览器内有效，并且个浏览器窗口见不共享，关闭浏览器就会消失。</p>
<p>同一台机器的两个浏览器窗口访问服务器时，会生成两个不同的session，但是有浏览器窗口内的链接，脚本等打开的新窗口除外。这类子窗口会共享父窗口的cookie，因此会共享一个session。</p>
<p>新打开的浏览器窗口会生成新的session，但子窗口除外，子窗口会共享父窗口的session。</p>
<p>如果客户端浏览器将cookie禁用，或者不支持cookie怎么办（绝大数手机浏览器不支持cookie）？</p>
<p>URL地址重写</p>
<h2 id="URL重写"><a href="#URL重写" class="headerlink" title="URL重写"></a>URL重写</h2><p>URL地址重写是对客户端不支持cookie的解决方案</p>
<p>URL地址重写的原理就是将用户的session的id信息重写到URL地址中，服务器能够够解析重写后的URL，从而获取session的id。这样即使客户端不支持cookie，也可以使用session来记录用户的状态了。</p>
<h2 id="cookie与session的区别"><a href="#cookie与session的区别" class="headerlink" title="cookie与session的区别"></a>cookie与session的区别</h2><ol>
<li><p>cookie数据存在客户端的浏览器上，session数据存放在服务器上</p>
</li>
<li><p>cookie不是很安全，别人可以分析存放在本地的cookie并进行cookie欺骗，考虑到安全应当那个使用session</p>
</li>
<li><p>session会在一定时间内保存在服务器上，当访问量增多，会占用比较多的服务器资源，考虑到减轻服务器性能方面，应当使用cookie</p>
</li>
<li><p>的那个cookie在客户端的限制是3k，就是说一个站点在客户端存放的cookie不能超过3k</p>
</li>
</ol>
</div></article></div><div class="tags"><a href="/tags/session/">session</a><a href="/tags/cookie/">cookie</a></div><div class="paginator"><a href="/2015/05/07/redis_master_slave_copy/" class="prev"><i class="fa fa-chevron-left"></i><span> Prev</span></a><a href="/2015/03/21/hashmap/" class="next"><span>Next</span><i class="fa fa-chevron-right"></i></a></div></section><footer><section id="comments"><div data-thread-key="http://dxer.github.io/2015/04/17/cookie_and_session/index.html" data-title="cookie与session" data-url="http://dxer.github.io/2015/04/17/cookie_and_session/index.html" class="ds-thread"></div><script type="text/javascript">var duoshuoQuery = {short_name: "smarthader" };
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
})();</script></section><div class="copyright"><p>© 2016<span class="heart"><i class="icon-next-heart fa fa-heart"></i></span><a href="http://dxer.github.io">dxer</a></p></div><div style="display:none"><script src="http://s11.cnzz.com/z_stat.php?id=1254885963&web_id=1254885963" language="JavaScript"></script></div></footer></div><label class="back2top"> <a href="#top"><i class="fa fa-chevron-up"></i></a></label></body></html>