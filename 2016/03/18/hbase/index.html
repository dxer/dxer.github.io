<!DOCTYPE html><html lang="en-lang"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>HBase入门 · dxer</title><meta name="description" content="HBase入门 - dxer"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.ico"><link rel="stylesheet" href="/css/style.css"><!-- fonts--><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" href="http://fonts.lug.ustc.edu.cn/css?family=Source+Sans+Pro:400,600" type="text/css"><!-- baidu analytics--><script type="text/javascript">var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?824de59e952801cadc44270759e656b9";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><!-- google analytics--><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-43614462-1', 'auto');
ga('send', 'pageview');</script></head><body><input type="checkbox" id="sidebar-toggle"><aside><div class="author"><a href="/."><img src="/img/author.png" class="author-img"></a><h2 class="author-name">dxer</h2></div><div class="post-toc"><span class="toc-title">Directory</span><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#HBase一些基本概念"><span class="toc-text">HBase一些基本概念</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HBase数据模型"><span class="toc-text">HBase数据模型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#写"><span class="toc-text">写</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#读"><span class="toc-text">读</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#删"><span class="toc-text">删</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HBase-Shell命令"><span class="toc-text">HBase Shell命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#create"><span class="toc-text">create</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#list"><span class="toc-text">list</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#put"><span class="toc-text">put</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#scan"><span class="toc-text">scan</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#get"><span class="toc-text">get</span></a></li></ol></li></ol></div></aside><div class="main"><header><div id="top"><a href="/." class="logo-link">dxer</a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">Archive</a></li><li class="nav-list-item"><a href="/tags/" target="_self" class="nav-list-link">Tags</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">About</a></li></ul></div></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">HBase入门</h1><div class="post-time">Mar 18, 2016</div><div class="post-content"><h1 id="HBase一些基本概念"><a href="#HBase一些基本概念" class="headerlink" title="HBase一些基本概念"></a>HBase一些基本概念</h1><p>1、Row key 行主键，在对HBase进行查询时候只能依靠Row key，HBase不支持条件查询等类似于一些主流数据库的查询方式，读取记录只能依赖行主键以及进行全局扫面，可以将行主键想象成主流数据库查询过程中用到的主键（例如，id）。</p>
<p>2、Column Family 列族，可以将列族想象成日常主流数据库中的表结构的所有列的一个大管家，列族中存储了所有列的名称，整个表包括多少列，列族就包括多少（除去Row key和Timestamp列）。</p>
<p>3、Column 列，HBase的每个列都隶属于一个列族，以列族名称作为前缀，同一列族中的所有列会聚集在一个存储单元上，同时按照Column key进行排序。</p>
<p>4、Timestamp 在HBase中，通过row key 和 Colum Family确定一份数据，同一个row key和Colum Family可能有多份不同的数据，HBase通过时间戳来区分这些数据，同时按照时间戳对左右的数据进行排序，最新的数据排在最前面，时间戳默认为系统当前时间（精确到毫秒），同时也可以人为设置该值。</p>
<p>5、Value 我们在HBase表中精确查询数据时，通过TableName找到表，接着通过Row key找到对应的行，然后通过ColumnKey找到相应的列，最后根据时间戳找到最新的需要查询的值，这个值就是value。</p>
<p>6、存储类型 在HBase中，表名称是字符串，行键和列名称是二进制值（即就是Java中的Byte[]），时间戳是一个64为的整数（Java中的long类型），最后的查询结果Value是字节数组（Java中的byte[]类型）。</p>
<p>7、存储结构</p>
<p>在HBase中，整个数据表是按照行键进行排序，每行包括任意数量的列，列和列之间通过列键进行排序，每列包括若干的数据，整个HBase的存储结构可以理解如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Table(</span><br><span class="line">    Row key，List(</span><br><span class="line">        SortedMap(</span><br><span class="line">            Column，list(</span><br><span class="line">            Value，Timestamp</span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="HBase数据模型"><a href="#HBase数据模型" class="headerlink" title="HBase数据模型"></a>HBase数据模型</h1><ol>
<li>表（table）：HBase用表组织数据。表名是字符串（String），由可以在文件系统路径里使用的字符组成。</li>
<li>行（row）：在表里，数据按行存储。行由行健（rowkey）唯一标识。行健没有数据类型，视为字节数组byte[]。</li>
<li>列族（column family）：行里的数据按照列族进行分组，列族也影响到HBase数据的物理存放。因此，他们必须事前定义并且不轻易修改。表中每行拥有相同列族，尽管行不需要在每个列族里存储数据，列族名字是字符串（String），由可以在文件系统路径里使用的字符组成。</li>
<li>列限定符（column qualifier）：列族里的数据通过列限定符或列来定位。列限定符不必事前定义。列限定符不必在不同行之间保持一致。就像行健一样，类限定符没有数据类型，视为字节数据byte[]。</li>
<li>单元（cell）：行健、列族和列限定符一起确定一个单元。存储在单元里的数据成为单元值（value）。值没有数据类型，视为字节数组byte[]。</li>
<li>时间版本（version）：单元值有时间版本。时间版本用时间戳标识，是一个long型。没有指定时间版本时，当前时间戳作为操作的基础。HBase保留单元值时间版本的数量基于列族进行配置。默认3个版本。</li>
</ol>
<p>数据坐标</p>
<p>行健、列族、列限定符和时间版本</p>
<h2 id="写"><a href="#写" class="headerlink" title="写"></a>写</h2><p>执行写入的时候会写到两个文件：预写式日志（write-ahead log，也称HLog）和MemStore。HBase的默认方式是把写入动作记录在这两个地方，以保证数据持久化。只有当这两个地方的变化信息都写入并确认后，才认为写动作完成。</p>
<p><em>MemStore</em>是内存里的写入缓冲区，HBase中数据在永久写入硬盘之前在这里积累。当MemStore填满后，其中的数据会刷写到硬盘，生成一个HFile文件。HFile是HBase使用底层存储格式。HFile对应列族，一个列族可以有多个HFile，但一个HFile不能存储多个列族的数据。在集群的每个节点上，每个列族都有一个MemStore。</p>
<p>注：不写入WAL会在RegionServer故障时增加丢失数据的风险。关闭WAL，出现故障时HBase可能无法恢复数据，没有刷写到硬盘的所有写入数据都会丢失。</p>
<h3 id="读"><a href="#读" class="headerlink" title="读"></a>读</h3><p>HBase在读操作上使用了LRU（最近最少使用算法）缓存技术。也叫作BlockCache。BlockCache设计用来保存从HFile里读入内存的频繁访问的数据，避免硬盘读。每个列族都有自己的BlockCache。</p>
<p>BlockCache中的Block是HBase从硬盘完成一次读取的数据单位。HFile物理存放形式是一个Block的序列外加这些Block的索引。从HBase中读取一个Block需要先将索引上查找一次改Block然后从硬盘读出、Block是建立索引的最小数据单位，也是从硬盘读取的最小数据单位。Block大小按照列族设定，默认是64kb。如果主要用于随机查询，可能需要细粒度的Block索引，小一点儿的Block更好一些。Block变小会导致索引变大，进而消耗更多内存。如果经常执行顺序扫描，一次读取多个Block，大一点的Block更好一些。Block变大意味着索引项变少，索引编写，因此节省内存。</p>
<p>从HBase总读出一行，首先会检查MemStore等待修改的队列，然后检查BlockCache看包含改行的Blocj是否最近被访问过，最后访问硬盘上对应的HFile。</p>
<h3 id="删"><a href="#删" class="headerlink" title="删"></a>删</h3><p>执行HBase删除命令的时候，实际上数据并不会立即删除，只是会在该数据上打上删除的记录。被标记的记录不能在Get和Scan命令中返回结果。因为HFile文件是不能改变的，直到执行一次大合并，含有这些标记的数据才会被处理，被删除的数据占用的空间才会释放。</p>
<p><em>大合并（major compaction）</em>：处理给定region的一个列族的所有HFile。大合并完成后，这个列族的所有HFile合并成一个文件，可以从Shell中收工出发整个表（或者特定region）的大合并。大合并是HBase清理被删除记录的唯一机会</p>
<p><em>小合并（minor compaction）</em>：把多个小HFile合并成一个大HFile。</p>
<hr>
<h1 id="HBase-Shell命令"><a href="#HBase-Shell命令" class="headerlink" title="HBase Shell命令"></a>HBase Shell命令</h1><table>
<thead>
<tr>
<th>Command</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>alter</td>
<td>修改列族模式</td>
</tr>
<tr>
<td>count</td>
<td>统计表中行的数量</td>
</tr>
<tr>
<td>create</td>
<td>创建表</td>
</tr>
<tr>
<td>describe</td>
<td>显示表相关的详细信息</td>
</tr>
<tr>
<td>delete</td>
<td>删除指定对象的值（可以为表，行，列对应的值，另外也可以指定时间戳的值）</td>
</tr>
<tr>
<td>deleteall</td>
<td>删除指定行的所有元素值</td>
</tr>
<tr>
<td>disable</td>
<td>使表无效</td>
</tr>
<tr>
<td>enable</td>
<td>使表有效</td>
</tr>
<tr>
<td>drop</td>
<td>删除表</td>
</tr>
<tr>
<td>exists</td>
<td>测试表是否存在</td>
</tr>
<tr>
<td>exit</td>
<td>退出HBase Shell的值</td>
</tr>
<tr>
<td>get</td>
<td>获取行或单元的值</td>
</tr>
<tr>
<td>incr</td>
<td>增加指定表、行或列的值</td>
</tr>
<tr>
<td>list</td>
<td>列出HBase中存在的所有表</td>
</tr>
<tr>
<td>put</td>
<td>向指定的表单元添加值</td>
</tr>
<tr>
<td>tools</td>
<td>列出HBase所支持的工具</td>
</tr>
<tr>
<td>scan</td>
<td>通过对表的扫描来获取对应的值</td>
</tr>
<tr>
<td>status</td>
<td>返回HBase集群的状态信息</td>
</tr>
<tr>
<td>shutdown</td>
<td>关闭HBase集群（与exit不同）</td>
</tr>
<tr>
<td>truncate</td>
<td>重新创建指定表</td>
</tr>
<tr>
<td>version</td>
<td>返回HBase版本信息</td>
</tr>
</tbody>
</table>
<h2 id="create"><a href="#create" class="headerlink" title="create"></a>create</h2><p>创建表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">create &apos;t1&apos;, &#123;NAME =&gt; &apos;f1&apos;, VERSIONS =&gt; 5&#125;</span><br><span class="line"></span><br><span class="line">create &apos;t1&apos;, &#123;Name =&gt; &apos;f1&apos;&#125;, &#123;NAME =&gt; &apos;f2&apos;&#125;, &#123;NAME =&gt; &apos;f3&apos;&#125;</span><br><span class="line"></span><br><span class="line">#等价于：</span><br><span class="line"></span><br><span class="line">create &apos;t1&apos;, &apos;cf&apos;, &apos;cf2&apos;, &apos;cf3&apos;</span><br></pre></td></tr></table></figure>
<h2 id="list"><a href="#list" class="headerlink" title="list"></a>list</h2><p>列出HBase中包含的表名称</p>
<h2 id="put"><a href="#put" class="headerlink" title="put"></a>put</h2><p>向指定表中添加值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">put &apos;t1&apos;, &apos;rowkey&apos;, &apos;cf:name&apos;, &apos;test&apos;, ts</span><br><span class="line">#向t1表的rowkey，列cf:name添加值name，并指定时间戳为ts</span><br></pre></td></tr></table></figure>
<h2 id="scan"><a href="#scan" class="headerlink" title="scan"></a>scan</h2><p>对表的扫描来获取对应的值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scan &apos;t1&apos;</span><br><span class="line">scan &apos;t1&apos;, &#123;COLUMNS =&gt; &apos;cf&apos;&#125;</span><br><span class="line">scan &apos;t1&apos;, &#123;COLUMNS =&gt; &apos;cf&apos;,  LIMIT =&gt; 10&#125;</span><br></pre></td></tr></table></figure>
<h2 id="get"><a href="#get" class="headerlink" title="get"></a>get</h2><p>获取行或者单元的值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">get &apos;t1&apos;, &apos;rowkey&apos;</span><br><span class="line">get &apos;t1&apos;, &apos;rowkey&apos;, &#123;COLUMN =&gt; &apos;cf:name&apos;&#125;</span><br></pre></td></tr></table></figure>
<p><em>注：COLUMN和COLUMNS是不同的，scan操作中的COLUMNS指定的是表的列族，get操作中的COLUMN指定的是特定的列，COLUMN的值是指上是”列族+列修饰符”</em></p>
</div></article></div><div class="tags"><a href="/tags/hbase/">hbase</a></div><div class="paginator"><a href="/2016/03/19/hbase简介/" class="prev"><i class="fa fa-chevron-left"></i><span> Prev</span></a><a href="/2016/03/11/hive02/" class="next"><span>Next</span><i class="fa fa-chevron-right"></i></a></div></section><footer><section id="comments"><div data-thread-key="http://dxer.github.io/2016/03/18/hbase/index.html" data-title="HBase入门" data-url="http://dxer.github.io/2016/03/18/hbase/index.html" class="ds-thread"></div><script type="text/javascript">var duoshuoQuery = {short_name: "smarthader" };
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
})();</script></section><div class="copyright"><p>© 2016<span class="heart"><i class="icon-next-heart fa fa-heart"></i></span><a href="http://dxer.github.io">dxer</a></p></div><div style="display:none"><script src="https://s11.cnzz.com/z_stat.php?id=1254885963&web_id=1254885963" language="JavaScript"></script></div></footer></div><label class="back2top"> <a href="#top"><i class="fa fa-chevron-up"></i></a></label></body></html>